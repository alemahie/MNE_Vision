
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>src.classification.applePy.classifier &#8212; MNE Vision 0.1.1 documentation</title>
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">MNE Vision 0.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for src.classification.applePy.classifier</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sn</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">randint</span>

<span class="kn">from</span> <span class="nn">mne</span> <span class="kn">import</span> <span class="n">Epochs</span><span class="p">,</span> <span class="n">concatenate_epochs</span><span class="p">,</span> <span class="n">read_epochs</span>
<span class="kn">from</span> <span class="nn">mne.io</span> <span class="kn">import</span> <span class="n">read_raw_eeglab</span><span class="p">,</span> <span class="n">read_epochs_eeglab</span>
<span class="kn">from</span> <span class="nn">mne.channels</span> <span class="kn">import</span> <span class="n">make_standard_montage</span>
<span class="kn">from</span> <span class="nn">mne.event</span> <span class="kn">import</span> <span class="n">find_events</span>

<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">RandomizedSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span><span class="p">,</span> <span class="n">LeaveOneOut</span><span class="p">,</span> <span class="n">GroupKFold</span>

<span class="kn">from</span> <span class="nn">pyriemann.estimation</span> <span class="kn">import</span> <span class="n">Covariances</span>

<span class="kn">from</span> <span class="nn">classification.applePy.channel_selection</span> <span class="kn">import</span> <span class="n">ElectrodeSelection</span>
<span class="kn">from</span> <span class="nn">classification.applePy.pipeline_catalogue</span> <span class="kn">import</span> <span class="n">Pipeline_catalogue</span>
<span class="kn">from</span> <span class="nn">classification.applePy.sources_estimator</span> <span class="kn">import</span> <span class="n">Sources_estimator</span>
<span class="kn">from</span> <span class="nn">classification.applePy.cnn</span> <span class="kn">import</span> <span class="n">CNN</span>

<span class="n">CONST_MAX_1by1_ELECTRODES</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">CONST_MAX_5by5_ELECTRODES</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">CONST_DEFAULT_RANDOMIZEDSEARCH_NBITER</span> <span class="o">=</span> <span class="mi">10</span>


<div class="viewcode-block" id="ApplePyClassifier"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier">[docs]</a><span class="k">class</span> <span class="nc">ApplePyClassifier</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Global class dealing with automated classification. Inherits BaseEstimator and TransformerMix, in order to make it adaptable to </span>
<span class="sd">    other estimators from other libraries. This class contains :  \n</span>
<span class="sd">        - A pipeline catalogue with all the pipelines and the important information about the parameters to fit \n</span>
<span class="sd">        - All the predictions and the prediction probabilities for all pipelines \n</span>
<span class="sd">        - All the correct answers \n</span>
<span class="sd">        - All the scores, confusion matrices, precisions, recalls, and ROC infos for all matrices \n</span>
<span class="sd">        - The dataset and the labels, as well as source dataset  \n</span>
<span class="sd">        - The group indices \n</span>
<span class="sd">        - The eventual test dataset, labels and groups \n</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">used_pipelines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_catalogue</span> <span class="o">=</span> <span class="n">Pipeline_catalogue</span><span class="p">(</span><span class="n">used_pipelines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_catalogue</span><span class="o">.</span><span class="n">catalogue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_catalogue</span><span class="o">.</span><span class="n">parameters_to_fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictions_proba</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_answers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scores_fold</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confusion_matrices</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precisions</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recalls</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roc_infos</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_sources</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_sources</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electrodes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_subj</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_names</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">test_dataset</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_groups</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pipelines</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ApplePyClassifier.modify_add_pipeline"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.modify_add_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">modify_add_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies or adds a new pipeline to the catalogue. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        name :  string \n</span>
<span class="sd">                name of the pipeline \n</span>
<span class="sd">        pipeline :  instance of pipeline \n</span>
<span class="sd">                    the pipeline to be used \n</span>
<span class="sd">        parameters :    see doc for pipeline catalogue \n</span>
<span class="sd">                    the notation for the parameters to fit \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_pipeline</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">new_pipeline</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_catalogue</span><span class="o">.</span><span class="n">modify_add_pipeline</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_pipeline</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictions_proba</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="ApplePyClassifier.delete_pipelines"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.delete_pipelines">[docs]</a>    <span class="k">def</span> <span class="nf">delete_pipelines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes a pipeline by calling the method from the pipeline catalogue.</span>
<span class="sd">        Additionally, deletes all occurences of the pipeline. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n </span>
<span class="sd">        name :  string \n</span>
<span class="sd">                name of the pipeline \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">pipeline_names</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Pipeline &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; does not exist.&quot;</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_catalogue</span><span class="o">.</span><span class="n">delete_pipeline</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions_proba</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">scores_fold</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">confusion_matrices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">recalls</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">roc_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>

<div class="viewcode-block" id="ApplePyClassifier.modify_parameters"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.modify_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">modify_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies a pipeline&#39;s parameters by calling the method from the pipeline catalogue. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        name :  string \n</span>
<span class="sd">                name of the pipeline \n</span>
<span class="sd">        parameters :    see doc for pipeline catalogue \n </span>
<span class="sd">                        the notation for the parameters to fit \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_catalogue</span><span class="o">.</span><span class="n">modify_parameters</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApplePyClassifier.restore"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.restore">[docs]</a>    <span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restores the classifier by restoring the predictions, predictions probabilities, expected answers, scores,</span>
<span class="sd">        confusion matrices, precisions, recalls and roc info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictions_proba</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_answers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confusion_matrices</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precisions</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recalls</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roc_infos</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    File reading</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ApplePyClassifier.read_one_file"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.read_one_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_one_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">bads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filtering</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span> <span class="n">tmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">tmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ICA</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads one non pre-epoched (raw) set file and saves the result in a -epo.fif file. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        file_path : path to the file to be opened \n</span>
<span class="sd">        file_name : name of the file \n</span>
<span class="sd">        destination : path where the -epo.fif file will be saved \n</span>
<span class="sd">        bads : list of electrodes to be rejected \n</span>
<span class="sd">        picks : list of electrodes to be worked on \n</span>
<span class="sd">        filtering : tuple containing the higher and lower frequencies to filter the data \n </span>
<span class="sd">        tmin, tmax : tmin, tmax for delimiting the epochs in time \n </span>
<span class="sd">        ICA : Boolean, whether or not to apply Independent Component Analysis \n</span>
<span class="sd">        resample : boolean, whether or not to resample the data at 512 Hz \n</span>
<span class="sd">        baseline : the baseline to be applied to the data  \n</span>
<span class="sd">        event_ids : The id of the event to consider \n</span>
<span class="sd">        reference : the name of the reference to be applied to the data \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading &quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">eeg</span> <span class="o">=</span> <span class="n">read_raw_eeglab</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">preload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eeg</span><span class="o">.</span><span class="n">set_eeg_reference</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resample</span><span class="p">:</span>
            <span class="n">eeg</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="n">npad</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">eeg</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;highpass&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">eeg</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lowpass&#39;</span><span class="p">]</span>
        <span class="n">eeg</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="n">eeg</span><span class="o">.</span><span class="n">notch_filter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">47.5</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">52.5</span><span class="p">]))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">events</span> <span class="o">=</span> <span class="n">find_events</span><span class="p">(</span><span class="n">eeg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid events in &quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">()</span>

        <span class="n">eeg</span><span class="o">.</span><span class="n">drop_channels</span><span class="p">(</span><span class="n">eeg</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;bads&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">bads</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eeg</span><span class="o">.</span><span class="n">drop_channels</span><span class="p">(</span><span class="n">bads</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">picks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eeg</span><span class="o">.</span><span class="n">pick_channels</span><span class="p">(</span><span class="n">picks</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ICA</span><span class="p">:</span>
            <span class="n">ica</span> <span class="o">=</span> <span class="n">ICA</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;extended-infomax&quot;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ica</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">eeg</span><span class="p">)</span>
            <span class="n">ica</span><span class="o">.</span><span class="n">plot_components</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="n">eeg</span><span class="p">)</span>
            <span class="n">ica</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">eeg</span><span class="p">)</span>
        <span class="n">epochs</span> <span class="o">=</span> <span class="n">Epochs</span><span class="p">(</span><span class="n">eeg</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">event_id</span><span class="o">=</span><span class="n">event_ids</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">)</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-epo.fif&#39;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">epochs</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApplePyClassifier.prepare_nonepoched_dataset"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.prepare_nonepoched_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_nonepoched_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">nb_subj</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">bads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filtering</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                                   <span class="n">ICA</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event_ids</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare a   subjects x epochs x channels x times     dataset from raw files  \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        directory : the path to the directory containing the dataset \n</span>
<span class="sd">        nb_subj : the number of subjects to be considered \n</span>
<span class="sd">        tmin, tmax : tmin, tmax for delimiting the epochs in time \n</span>
<span class="sd">        bads : list of electrodes to be rejected \n</span>
<span class="sd">        picks : list of electrodes to be worked on \n</span>
<span class="sd">        filtering : tuple containing the higher and lower frequencies to filter the data \n</span>
<span class="sd">        tmin, tmax : tmin, tmax for delimiting the epochs in time \n</span>
<span class="sd">        ICA : Boolean, whether or not to apply Independent Component Analysis \n</span>
<span class="sd">        resample : boolean, whether or not to resample the data at 512 Hz \n</span>
<span class="sd">        baseline : the baseline to be applied to the data  \n</span>
<span class="sd">        event_ids : The id of the event to consider \n</span>
<span class="sd">        reference : the name of the reference to be applied to the data \n</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># MNE loading parameters</span>
        <span class="c1"># montage = make_standard_montage(&quot;standard_1005&quot;)</span>

        <span class="c1"># Load raw EEG data</span>
        <span class="c1"># =================</span>
        <span class="n">data_root_folder</span> <span class="o">=</span> <span class="n">directory</span>
        <span class="n">paradigms</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="c1"># epoched_raw_eeg_dataset = [[] for _ in range(nb_subj)]</span>
        <span class="c1"># epoched_raw_eeg_sources = [[] for _ in range(nb_subj)]</span>
        <span class="c1"># labels = [[] for _ in range(nb_subj)]</span>
        <span class="c1"># labels_sources = [[] for _ in range(nb_subj)]</span>
        <span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># epochs = []</span>
        <span class="c1"># groups = []</span>

        <span class="n">directory_new</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;epoched&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory_new</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory_new</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">paradigm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">paradigms</span><span class="p">):</span>
            <span class="n">data_class_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_root_folder</span><span class="p">,</span> <span class="n">paradigm</span><span class="p">)</span>
            <span class="n">epoched_data_class_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory_new</span><span class="p">,</span> <span class="n">paradigm</span><span class="p">)</span>
            <span class="n">list_of_files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">list_of_dirs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">event_id</span> <span class="o">=</span> <span class="n">event_ids</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">data_class_folder</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;.set&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">:</span>
                    <span class="n">list_of_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;directory&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">:</span>
                    <span class="n">list_of_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file</span><span class="p">)</span>
            <span class="n">list_of_files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">list_of_dirs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">subject_i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">epoched_data_class_folder</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">epoched_data_class_folder</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">subject_i</span><span class="p">,</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">):</span>
                <span class="n">raw_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_class_folder</span><span class="p">,</span> <span class="n">raw_eeg_file</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_one_file</span><span class="p">(</span><span class="n">raw_file_path</span><span class="p">,</span> <span class="n">raw_eeg_file</span><span class="p">,</span> <span class="n">epoched_data_class_folder</span><span class="p">,</span> <span class="n">bads</span><span class="p">,</span> <span class="n">picks</span><span class="p">,</span> <span class="n">filtering</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span>
                                   <span class="n">tmax</span><span class="p">,</span> <span class="n">ICA</span><span class="o">=</span><span class="n">ICA</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="n">resample</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">,</span> <span class="n">event_ids</span><span class="o">=</span><span class="n">event_id</span><span class="p">,</span>
                                   <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">subject_j</span><span class="p">,</span> <span class="n">raw_eeg_dir</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_dirs</span><span class="p">):</span>
                <span class="n">raw_path_subject</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_class_folder</span><span class="p">,</span> <span class="n">raw_eeg_dir</span><span class="p">)</span>
                <span class="n">epoched_raw_path_subject</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">epoched_data_class_folder</span><span class="p">,</span> <span class="n">raw_eeg_dir</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">epoched_raw_path_subject</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">epoched_raw_path_subject</span><span class="p">)</span>
                <span class="n">subject_files</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">raw_path_subject</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s2">&quot;.set&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">:</span>
                        <span class="n">subject_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file</span><span class="p">)</span>
                    <span class="c1"># nb_files = len(subject_files)</span>
                <span class="k">if</span> <span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">&lt;</span> <span class="n">nb_subj</span><span class="p">:</span>
                    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_dir</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="n">subject_files</span><span class="p">:</span>
                        <span class="n">raw_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">raw_path_subject</span><span class="p">,</span> <span class="n">raw_eeg_file</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">read_one_file</span><span class="p">(</span><span class="n">raw_file_path</span><span class="p">,</span> <span class="n">raw_eeg_file</span><span class="p">,</span> <span class="n">epoched_raw_path_subject</span><span class="p">,</span> <span class="n">bads</span><span class="p">,</span> <span class="n">picks</span><span class="p">,</span>
                                           <span class="n">filtering</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">ICA</span><span class="o">=</span><span class="n">ICA</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="n">resample</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">,</span>
                                           <span class="n">event_ids</span><span class="o">=</span><span class="n">event_id</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApplePyClassifier.read_all_files"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.read_all_files">[docs]</a>    <span class="k">def</span> <span class="nf">read_all_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">nb_subj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">divided_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">filtering</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">pre_epoched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ICA</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">event_ids</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a   subjects x epochs x channels x times     dataset from epoched files. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        directory : the path to the directory containing the dataset \n</span>
<span class="sd">        nb_subj : the number of subjects to be considered \n</span>
<span class="sd">        divided_dataset : boolean; whether or not the dataset is divided by classes \n</span>
<span class="sd">        tmin, tmax : tmin, tmax for delimiting the epochs in time \n</span>
<span class="sd">        bads : list of electrodes to be rejected \n</span>
<span class="sd">        picks : list of electrodes to be worked on \n</span>
<span class="sd">        filtering : tuple containing the higher and lower frequencies to filter the data \n</span>
<span class="sd">        pre_epoched : boolean; whether or not the dataset has been pre-epoched \n </span>
<span class="sd">        tmin, tmax : tmin, tmax for delimiting the epochs in time \n</span>
<span class="sd">        ICA : Boolean, whether or not to apply Independent Component Analysis \n</span>
<span class="sd">        resample : boolean, whether or not to resample the data at 512 Hz \n</span>
<span class="sd">        baseline : the baseline to be applied to the data  \n</span>
<span class="sd">        event_ids : The id of the event to consider \n</span>
<span class="sd">        reference : the name of the reference to be applied to the data \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nb_subj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nb_subj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_subjects</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pre_epoched</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">divided_dataset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_preepoched_oneFilePerSubj</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">nb_subj</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">bads</span><span class="o">=</span><span class="n">bads</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="n">picks</span><span class="p">,</span>
                                                <span class="n">filtering</span><span class="o">=</span><span class="n">filtering</span><span class="p">,</span> <span class="n">ICA</span><span class="o">=</span><span class="n">ICA</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="n">resample</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">,</span>
                                                <span class="n">event_ids</span><span class="o">=</span><span class="n">event_ids</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[(</span><span class="s2">&quot;directory&quot;</span><span class="p">,</span> <span class="n">directory</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;nb of subjects&quot;</span><span class="p">,</span> <span class="n">nb_subj</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;tmin&quot;</span><span class="p">,</span> <span class="n">tmin</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;tmax&quot;</span><span class="p">,</span> <span class="n">tmax</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;bads&quot;</span><span class="p">,</span> <span class="n">bads</span><span class="p">),</span>
             <span class="p">(</span><span class="s2">&quot;picks&quot;</span><span class="p">,</span> <span class="n">picks</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;filtering&quot;</span><span class="p">,</span> <span class="n">filtering</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;pre_epoched&#39;</span><span class="p">,</span> <span class="n">pre_epoched</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ICA&#39;</span><span class="p">,</span> <span class="n">ICA</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;resample&#39;</span><span class="p">,</span> <span class="n">resample</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span> <span class="n">baseline</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;event_ids&#39;</span><span class="p">,</span> <span class="n">event_ids</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;reference&#39;</span><span class="p">,</span> <span class="n">reference</span><span class="p">)])</span>
        <span class="c1"># MNE loading parameters</span>
        <span class="n">montage</span> <span class="o">=</span> <span class="n">make_standard_montage</span><span class="p">(</span><span class="s2">&quot;standard_1005&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">pre_epoched</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">divided_dataset</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prepare_nonepoched_dataset</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">nb_subj</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">bads</span><span class="o">=</span><span class="n">bads</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="n">picks</span><span class="p">,</span>
                                                <span class="n">filtering</span><span class="o">=</span><span class="n">filtering</span><span class="p">,</span> <span class="n">ICA</span><span class="o">=</span><span class="n">ICA</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="n">resample</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">,</span>
                                                <span class="n">event_ids</span><span class="o">=</span><span class="n">event_ids</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">)</span>
                <span class="c1"># print(&quot;would have prepared&quot;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prepare_nonepoched_dataset_oneFilePerSubj</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">nb_subj</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">bads</span><span class="o">=</span><span class="n">bads</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="n">picks</span><span class="p">,</span>
                                                               <span class="n">filtering</span><span class="o">=</span><span class="n">filtering</span><span class="p">,</span> <span class="n">ICA</span><span class="o">=</span><span class="n">ICA</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="n">resample</span><span class="p">,</span>
                                                               <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">,</span> <span class="n">event_ids</span><span class="o">=</span><span class="n">event_ids</span><span class="p">,</span>
                                                               <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">)</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;epoched&quot;</span><span class="p">)</span>

        <span class="c1"># Load raw EEG data</span>
        <span class="c1"># =================</span>

        <span class="n">data_root_folder</span> <span class="o">=</span> <span class="n">directory</span>
        <span class="n">paradigms</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="n">epoched_raw_eeg_dataset</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_subj</span><span class="p">)]</span>
        <span class="n">epoched_raw_eeg_sources</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_subj</span><span class="p">)]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_subj</span><span class="p">)]</span>
        <span class="n">labels_sources</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_subj</span><span class="p">)]</span>
        <span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># epochs = []</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">enumerated_paradigms</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">paradigms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paradigms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;nb of paradigms&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">paradigm</span> <span class="ow">in</span> <span class="n">enumerated_paradigms</span><span class="p">:</span>
            <span class="n">event_id</span> <span class="o">=</span> <span class="n">event_ids</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="n">data_class_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_root_folder</span><span class="p">,</span> <span class="n">paradigm</span><span class="p">)</span>
            <span class="n">list_of_files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">list_of_dirs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">data_class_folder</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;.set&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;-epo.fif&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">):</span>
                    <span class="n">list_of_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;directory&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">:</span>
                    <span class="n">list_of_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file</span><span class="p">)</span>
            <span class="n">list_of_files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">list_of_dirs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">subject_i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">subject_i</span><span class="p">,</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">subject_i</span> <span class="o">&lt;</span> <span class="n">nb_subj</span><span class="p">:</span>
                    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file</span><span class="p">)</span>
                    <span class="n">raw_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_class_folder</span><span class="p">,</span> <span class="n">raw_eeg_file</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">pre_epoched</span><span class="p">:</span>
                        <span class="n">epoched_eeg</span> <span class="o">=</span> <span class="n">read_epochs_eeglab</span><span class="p">(</span><span class="n">raw_file_path</span><span class="p">,</span> <span class="n">montage</span><span class="o">=</span><span class="n">montage</span><span class="p">,</span> <span class="n">event_id</span><span class="o">=</span><span class="n">event_id</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">set_eeg_reference</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;highpass&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lowpass&#39;</span><span class="p">]</span>
                        <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">picks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">pick_channels</span><span class="p">(</span><span class="n">picks</span><span class="p">)</span>
                        <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">resample</span><span class="p">:</span>
                            <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">epoched_eeg</span> <span class="o">=</span> <span class="n">read_epochs</span><span class="p">(</span>
                            <span class="n">raw_file_path</span><span class="p">)</span>  <span class="c1"># not read_epochs_eeglab because it doesn&#39;t work for .fif, and because it&#39;s already preprocessed</span>

                    <span class="n">epoched_sources</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">epoched_eeg</span><span class="p">)</span>
                    <span class="n">epoched_data</span> <span class="o">=</span> <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

                    <span class="n">epoched_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">epoched_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span> <span class="o">+</span> <span class="n">label</span>
                    <span class="n">epoched_labels_sources</span> <span class="o">=</span> <span class="n">label</span>

                    <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_data</span><span class="p">)</span>
                    <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_labels</span><span class="p">)</span>

                    <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_sources</span><span class="p">)</span>
                    <span class="n">labels_sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_labels_sources</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">subject_j</span><span class="p">,</span> <span class="n">raw_eeg_dir</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_dirs</span><span class="p">):</span>
                <span class="n">raw_path_subject</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_class_folder</span><span class="p">,</span> <span class="n">raw_eeg_dir</span><span class="p">)</span>
                <span class="n">subject_files</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">raw_path_subject</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;.set&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;-epo.fif&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">):</span>
                        <span class="n">subject_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file</span><span class="p">)</span>
                    <span class="n">nb_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subject_files</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">nb_subj</span><span class="p">:</span>
                    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_dir</span><span class="p">)</span>
                    <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="k">for</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="n">subject_files</span><span class="p">:</span>
                        <span class="n">raw_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">raw_path_subject</span><span class="p">,</span> <span class="n">raw_eeg_file</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">pre_epoched</span><span class="p">:</span>
                            <span class="n">epoched_eeg</span> <span class="o">=</span> <span class="n">read_epochs_eeglab</span><span class="p">(</span><span class="n">raw_file_path</span><span class="p">,</span> <span class="n">montage</span><span class="o">=</span><span class="n">montage</span><span class="p">,</span> <span class="n">event_id</span><span class="o">=</span><span class="n">event_id</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">set_eeg_reference</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;highpass&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lowpass&#39;</span><span class="p">]</span>
                            <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">picks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">pick_channels</span><span class="p">(</span><span class="n">picks</span><span class="p">)</span>
                            <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">epoched_eeg</span> <span class="o">=</span> <span class="n">read_epochs</span><span class="p">(</span><span class="n">raw_file_path</span><span class="p">)</span>

                        <span class="n">epoched_sources</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">epoched_eeg</span><span class="p">)</span>
                        <span class="n">epoched_data</span> <span class="o">=</span> <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

                        <span class="n">epoched_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">epoched_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span> <span class="o">+</span> <span class="n">label</span>
                        <span class="n">epoched_labels_sources</span> <span class="o">=</span> <span class="n">label</span>
                        <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_data</span><span class="p">)</span>
                        <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_labels</span><span class="p">)</span>

                        <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_sources</span><span class="p">)</span>
                        <span class="n">labels_sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_labels_sources</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">nb_files</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]))</span>
                        <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]))</span>
                        <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">concatenate_epochs</span><span class="p">(</span>
                            <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">subject_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">epoched_raw_eeg_dataset</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">first</span> <span class="o">=</span> <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">second</span> <span class="o">=</span> <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">])</span>
                <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="n">minimum</span><span class="p">]</span>
                <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">1</span><span class="p">][:</span><span class="n">minimum</span><span class="p">]</span>
                <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="n">minimum</span><span class="p">]</span>
                <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">1</span><span class="p">][:</span><span class="n">minimum</span><span class="p">]</span>
            <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subject_i</span><span class="p">)</span>
            <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">epoched_raw_eeg_sources</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">epoched_raw_eeg_sources</span><span class="p">)</span>
            <span class="n">labels_sources</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">labels_sources</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">picks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">electrodes</span> <span class="o">=</span> <span class="n">picks</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">electrodes</span> <span class="o">=</span> <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;ch_names&#39;</span><span class="p">]</span>

        <span class="n">epoched_raw_eeg_dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">epoched_raw_eeg_dataset</span><span class="p">)</span>
        <span class="c1"># labels_sources = np.asarray(labels_sources)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">epoched_raw_eeg_dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_sources</span> <span class="o">=</span> <span class="n">epoched_raw_eeg_sources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electrodes</span> <span class="o">=</span> <span class="n">electrodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">labs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
        <span class="n">unique</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labs</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">occurences</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">unique</span><span class="p">,</span> <span class="n">counts</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;occurences from each class : &quot;</span><span class="p">,</span> <span class="n">occurences</span><span class="p">))</span></div>

<div class="viewcode-block" id="ApplePyClassifier.read_preepoched_oneFilePerSubj"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.read_preepoched_oneFilePerSubj">[docs]</a>    <span class="k">def</span> <span class="nf">read_preepoched_oneFilePerSubj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">nb_subj</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">bads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                       <span class="n">filtering</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">ICA</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                       <span class="n">event_ids</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a   subjects x epochs x channels x times     dataset from epoched files. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        directory : the path to the directory containing the dataset \n</span>
<span class="sd">        nb_subj : the number of subjects to be considered \n</span>
<span class="sd">        tmin, tmax : tmin, tmax for delimiting the epochs in time \n</span>
<span class="sd">        bads : list of electrodes to be rejected \n</span>
<span class="sd">        picks : list of electrodes to be worked on \n</span>
<span class="sd">        filtering : tuple containing the higher and lower frequencies to filter the data \n</span>
<span class="sd">        tmin, tmax : tmin, tmax for delimiting the epochs in time \n</span>
<span class="sd">        ICA : Boolean, whether or not to apply Independent Component Analysis \n</span>
<span class="sd">        resample : boolean, whether or not to resample the data at 512 Hz \n</span>
<span class="sd">        baseline : the baseline to be applied to the data  \n</span>
<span class="sd">        event_ids : The id of the event to consider \n</span>
<span class="sd">        reference : the name of the reference to be applied to the data \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[(</span><span class="s2">&quot;directory&quot;</span><span class="p">,</span> <span class="n">directory</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;nb_subj&quot;</span><span class="p">,</span> <span class="n">nb_subj</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;tmin&quot;</span><span class="p">,</span> <span class="n">tmin</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;tmax&quot;</span><span class="p">,</span> <span class="n">tmax</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;bads&quot;</span><span class="p">,</span> <span class="n">bads</span><span class="p">),</span>
             <span class="p">(</span><span class="s2">&quot;picks&quot;</span><span class="p">,</span> <span class="n">picks</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;filtering&quot;</span><span class="p">,</span> <span class="n">filtering</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;pre_epoched&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ICA&#39;</span><span class="p">,</span> <span class="n">ICA</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;resample&#39;</span><span class="p">,</span> <span class="n">resample</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span> <span class="n">baseline</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;event_ids&#39;</span><span class="p">,</span> <span class="n">event_ids</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;reference&#39;</span><span class="p">,</span> <span class="n">reference</span><span class="p">)])</span>
        <span class="c1"># MNE loading parameters</span>
        <span class="n">montage</span> <span class="o">=</span> <span class="n">make_standard_montage</span><span class="p">(</span><span class="s2">&quot;standard_1005&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">event_ids</span><span class="p">)</span>
        <span class="c1"># self.classifier_log.append((&#39;nb of paradigms&#39;, nb_paradigms))</span>
        <span class="c1"># Load raw EEG data</span>
        <span class="c1"># =================</span>

        <span class="n">data_root_folder</span> <span class="o">=</span> <span class="n">directory</span>
        <span class="n">epoched_raw_eeg_dataset</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_subj</span><span class="p">)]</span>
        <span class="n">epoched_raw_eeg_sources</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_subj</span><span class="p">)]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_subj</span><span class="p">)]</span>
        <span class="n">labels_sources</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_subj</span><span class="p">)]</span>
        <span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># epochs = []</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">list_of_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">list_of_dirs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">data_root_folder</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;.set&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;-epo.fif&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">):</span>
                <span class="n">list_of_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;directory&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">:</span>
                <span class="n">list_of_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file</span><span class="p">)</span>
        <span class="n">list_of_files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">list_of_dirs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="c1"># subject_i = -1</span>
        <span class="k">for</span> <span class="n">subject_i</span><span class="p">,</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">subject_i</span> <span class="o">&lt;</span> <span class="n">nb_subj</span><span class="p">:</span>
                <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file</span><span class="p">)</span>
                <span class="n">raw_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_root_folder</span><span class="p">,</span> <span class="n">raw_eeg_file</span><span class="p">)</span>  <span class="c1"># data_class_folder</span>

                <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">event_ids</span><span class="p">)):</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">condition</span>
                    <span class="n">epoched_eeg</span> <span class="o">=</span> <span class="n">read_epochs_eeglab</span><span class="p">(</span><span class="n">raw_file_path</span><span class="p">,</span> <span class="n">event_id</span><span class="o">=</span><span class="n">event_ids</span><span class="p">[</span><span class="n">condition</span><span class="p">])</span>  <span class="c1"># montage=montage</span>
                    <span class="k">if</span> <span class="n">reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">set_eeg_reference</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;highpass&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lowpass&#39;</span><span class="p">]</span>
                    <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">picks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">pick_channels</span><span class="p">(</span><span class="n">picks</span><span class="p">)</span>
                    <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">)</span>

                    <span class="n">epoched_sources</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">epoched_eeg</span><span class="p">)</span>
                    <span class="n">epoched_data</span> <span class="o">=</span> <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

                    <span class="n">epoched_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">epoched_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span> <span class="o">+</span> <span class="n">label</span>
                    <span class="n">epoched_labels_sources</span> <span class="o">=</span> <span class="n">label</span>

                    <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_data</span><span class="p">)</span>
                    <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_labels</span><span class="p">)</span>

                    <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_sources</span><span class="p">)</span>
                    <span class="n">labels_sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_labels_sources</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">subject_j</span><span class="p">,</span> <span class="n">raw_eeg_dir</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_dirs</span><span class="p">):</span>
                <span class="n">raw_path_subject</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">raw_file_path</span><span class="p">,</span> <span class="n">raw_eeg_dir</span><span class="p">)</span>
                <span class="n">subject_files</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">raw_eeg_file_path</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">raw_path_subject</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;.set&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file_path</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;-epo.fif&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file_path</span><span class="p">):</span>
                        <span class="n">subject_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file_path</span><span class="p">)</span>
                    <span class="n">nb_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subject_files</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">nb_subj</span><span class="p">:</span>
                    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_dir</span><span class="p">)</span>
                    <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="k">for</span> <span class="n">raw_eeg_subject_file</span> <span class="ow">in</span> <span class="n">subject_files</span><span class="p">:</span>
                        <span class="n">raw_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">raw_path_subject</span><span class="p">,</span> <span class="n">raw_eeg_subject_file</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">event_ids</span><span class="p">)):</span>

                            <span class="n">label</span> <span class="o">=</span> <span class="n">condition</span>
                            <span class="n">epoched_eeg</span> <span class="o">=</span> <span class="n">read_epochs_eeglab</span><span class="p">(</span><span class="n">raw_file_path</span><span class="p">,</span> <span class="n">montage</span><span class="o">=</span><span class="n">montage</span><span class="p">,</span>
                                                             <span class="n">event_id</span><span class="o">=</span><span class="n">event_ids</span><span class="p">[</span><span class="n">condition</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">set_eeg_reference</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;highpass&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lowpass&#39;</span><span class="p">]</span>
                            <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filtering</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filtering</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">picks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">pick_channels</span><span class="p">(</span><span class="n">picks</span><span class="p">)</span>
                            <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">)</span>

                            <span class="n">epoched_sources</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">epoched_eeg</span><span class="p">)</span>
                            <span class="n">epoched_data</span> <span class="o">=</span> <span class="n">epoched_eeg</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

                            <span class="n">epoched_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">epoched_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span> <span class="o">+</span> <span class="n">label</span>
                            <span class="n">epoched_labels_sources</span> <span class="o">=</span> <span class="n">label</span>
                            <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_data</span><span class="p">)</span>
                            <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_labels</span><span class="p">)</span>

                            <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_sources</span><span class="p">)</span>
                            <span class="n">labels_sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoched_labels_sources</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">nb_files</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]))</span>
                        <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]))</span>
                        <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">concatenate_epochs</span><span class="p">(</span>
                            <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">subject_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">epoched_raw_eeg_dataset</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">first</span> <span class="o">=</span> <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">second</span> <span class="o">=</span> <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">])</span>
                <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="n">minimum</span><span class="p">]</span>
                <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">1</span><span class="p">][:</span><span class="n">minimum</span><span class="p">]</span>
                <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="n">minimum</span><span class="p">]</span>
                <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span><span class="p">][</span><span class="mi">1</span><span class="p">][:</span><span class="n">minimum</span><span class="p">]</span>
            <span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epoched_raw_eeg_dataset</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subject_i</span><span class="p">)</span>
            <span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">subject_i</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># epoched_raw_eeg_sources = np.asarray(epoched_raw_eeg_sources)</span>
            <span class="n">labels_sources</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">labels_sources</span><span class="p">)</span>

        <span class="n">electrodes</span> <span class="o">=</span> <span class="n">epoched_raw_eeg_sources</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;ch_names&#39;</span><span class="p">]</span>

        <span class="n">epoched_raw_eeg_dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">epoched_raw_eeg_dataset</span><span class="p">)</span>
        <span class="c1"># labels_sources = np.asarray(labels_sources)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">epoched_raw_eeg_dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_sources</span> <span class="o">=</span> <span class="n">epoched_raw_eeg_sources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electrodes</span> <span class="o">=</span> <span class="n">electrodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">labs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
        <span class="n">unique</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labs</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">occurences</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">unique</span><span class="p">,</span> <span class="n">counts</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;occurences from each class : &quot;</span><span class="p">,</span> <span class="n">occurences</span><span class="p">))</span></div>

<div class="viewcode-block" id="ApplePyClassifier.prepare_nonepoched_dataset_oneFilePerSubj"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.prepare_nonepoched_dataset_oneFilePerSubj">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_nonepoched_dataset_oneFilePerSubj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">nb_subj</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">bads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                  <span class="n">filtering</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">ICA</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                  <span class="n">event_ids</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare a   subjects x epochs x channels x times     dataset from raw files  \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        directory : the path to the directory containing the dataset \n</span>
<span class="sd">        nb_subj : the number of subjects to be considered \n</span>
<span class="sd">        tmin, tmax : tmin, tmax for delimiting the epochs in time \n</span>
<span class="sd">        bads : list of electrodes to be rejected \n</span>
<span class="sd">        picks : list of electrodes to be worked on \n</span>
<span class="sd">        filtering : tuple containing the higher and lower frequencies to filter the data \n</span>
<span class="sd">        tmin, tmax : tmin, tmax for delimiting the epochs in time \n</span>
<span class="sd">        ICA : Boolean, whether or not to apply Independent Component Analysis \n</span>
<span class="sd">        resample : boolean, whether or not to resample the data at 512 Hz \n</span>
<span class="sd">        baseline : the baseline to be applied to the data  \n</span>
<span class="sd">        event_ids : The id of the event to consider \n</span>
<span class="sd">        reference : the name of the reference to be applied to the data \n</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># MNE loading parameters</span>
        <span class="c1"># montage = make_standard_montage(&quot;standard_1005&quot;)</span>

        <span class="c1"># Load raw EEG data</span>
        <span class="c1"># =================</span>
        <span class="n">data_root_folder</span> <span class="o">=</span> <span class="n">directory</span>

        <span class="c1"># epoched_raw_eeg_dataset = [[] for _ in range(nb_subj)]</span>
        <span class="c1"># epoched_raw_eeg_sources = [[] for _ in range(nb_subj)]</span>
        <span class="c1"># labels = [[] for _ in range(nb_subj)]</span>
        <span class="c1"># labels_sources = [[] for _ in range(nb_subj)]</span>
        <span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># epochs = []</span>
        <span class="c1"># groups = []</span>

        <span class="n">directory_new</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;epoched&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory_new</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory_new</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">paradigm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">event_ids</span><span class="p">)):</span>
            <span class="n">epoched_data_class_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory_new</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">paradigm</span><span class="p">))</span>
            <span class="n">list_of_files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">list_of_dirs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">event_id</span> <span class="o">=</span> <span class="n">event_ids</span><span class="p">[</span><span class="n">paradigm</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">data_root_folder</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;.set&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">:</span>
                    <span class="n">list_of_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;directory&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">:</span>
                    <span class="n">list_of_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file</span><span class="p">)</span>
            <span class="n">list_of_files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">list_of_dirs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">subject_i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">epoched_data_class_folder</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">epoched_data_class_folder</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">subject_i</span><span class="p">,</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">):</span>
                <span class="n">raw_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_root_folder</span><span class="p">,</span> <span class="n">raw_eeg_file</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_one_file</span><span class="p">(</span><span class="n">raw_file_path</span><span class="p">,</span> <span class="n">raw_eeg_file</span><span class="p">,</span> <span class="n">epoched_data_class_folder</span><span class="p">,</span> <span class="n">bads</span><span class="p">,</span> <span class="n">picks</span><span class="p">,</span> <span class="n">filtering</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span>
                                   <span class="n">tmax</span><span class="p">,</span> <span class="n">ICA</span><span class="o">=</span><span class="n">ICA</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="n">resample</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">,</span> <span class="n">event_ids</span><span class="o">=</span><span class="n">event_id</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">subject_j</span><span class="p">,</span> <span class="n">raw_eeg_dir</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_dirs</span><span class="p">):</span>
                <span class="n">raw_path_subject</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_root_folder</span><span class="p">,</span> <span class="n">raw_eeg_dir</span><span class="p">)</span>
                <span class="n">epoched_raw_path_subject</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">epoched_data_class_folder</span><span class="p">,</span> <span class="n">raw_eeg_dir</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">epoched_raw_path_subject</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">epoched_raw_path_subject</span><span class="p">)</span>
                <span class="n">subject_files</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">raw_path_subject</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s2">&quot;.set&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">:</span>
                        <span class="n">subject_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file</span><span class="p">)</span>
                    <span class="c1"># nb_files = len(subject_files)</span>
                <span class="k">if</span> <span class="n">subject_i</span> <span class="o">+</span> <span class="n">subject_j</span> <span class="o">&lt;</span> <span class="n">nb_subj</span><span class="p">:</span>
                    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_dir</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="n">subject_files</span><span class="p">:</span>
                        <span class="n">raw_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">raw_path_subject</span><span class="p">,</span> <span class="n">raw_eeg_file</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">read_one_file</span><span class="p">(</span><span class="n">raw_file_path</span><span class="p">,</span> <span class="n">raw_eeg_file</span><span class="p">,</span> <span class="n">epoched_raw_path_subject</span><span class="p">,</span> <span class="n">bads</span><span class="p">,</span> <span class="n">picks</span><span class="p">,</span>
                                           <span class="n">filtering</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">ICA</span><span class="o">=</span><span class="n">ICA</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="n">resample</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">,</span>
                                           <span class="n">event_ids</span><span class="o">=</span><span class="n">event_id</span><span class="p">)</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computation</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ApplePyClassifier.estimate_sources"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.estimate_sources">[docs]</a>    <span class="k">def</span> <span class="nf">estimate_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_dataset</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">tmin_noise</span><span class="p">,</span> <span class="n">tmax_noise</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sourceSpaces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">bemSolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mixedSourceSpaces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">snr</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimates the sources for the dataset using a Sources_estimator object. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        --------- \n</span>
<span class="sd">        raw_dataset : the dataset to be estimated \n</span>
<span class="sd">        info : info dictionary for the EEG recordings (see Epochs.info) \n</span>
<span class="sd">        tmin_noise, tmax_noise : tmin and tmax for delimiting the noise estimation \n</span>
<span class="sd">        trans=None : path to the eventual coregistration file \n</span>
<span class="sd">        sourceSpaces : path to the eventual source spaces file \n</span>
<span class="sd">        bemSolution : path to the eventual bem solution file \n</span>
<span class="sd">        mixedSourceSpaces : path to the eventual mixed source spaces file \n</span>
<span class="sd">        loose : between 0 and 1. &quot;value that weights the source variances of the dipole components that are parallel (tangential) to the cortical surface&quot; \n</span>
<span class="sd">        snr = signal to noise ratio value \n</span>
<span class="sd">        fixed : Boolean, whether or not to use fixed source orientations normal to the cortical mantle \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sources_estimator</span> <span class="o">=</span> <span class="n">Sources_estimator</span><span class="p">(</span><span class="n">raw_dataset</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">tmin_noise</span><span class="p">,</span> <span class="n">tmax_noise</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span>
                                              <span class="n">sourceSpaces</span><span class="o">=</span><span class="n">sourceSpaces</span><span class="p">,</span>
                                              <span class="n">bemSolution</span><span class="o">=</span><span class="n">bemSolution</span><span class="p">,</span> <span class="n">mixedSourceSpaces</span><span class="o">=</span><span class="n">mixedSourceSpaces</span><span class="p">,</span> <span class="n">loose</span><span class="o">=</span><span class="n">loose</span><span class="p">,</span>
                                              <span class="n">snr</span><span class="o">=</span><span class="n">snr</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="n">fixed</span><span class="p">)</span>
        <span class="n">labels</span><span class="p">,</span> <span class="n">labeled_sources</span> <span class="o">=</span> <span class="n">sources_estimator</span><span class="o">.</span><span class="n">estimate_sources</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_sources</span> <span class="o">=</span> <span class="n">labeled_sources</span>
        <span class="k">return</span> <span class="n">labels</span></div>

<div class="viewcode-block" id="ApplePyClassifier.estimate_covariance_matrices"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.estimate_covariance_matrices">[docs]</a>    <span class="k">def</span> <span class="nf">estimate_covariance_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the simple covariance matrices for the raw data. \n</span>
<span class="sd">        Result format = nb_subj  x  nb_epochs  x  nb_channels  x  nb_channels \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        dataset : the dataset on which to estimate the covariance matrices. \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">covariance_matrices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_subj</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">covariance_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Covariances</span><span class="p">(</span><span class="s2">&quot;oas&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
                <span class="n">covariance_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Covariances</span><span class="p">(</span><span class="s2">&quot;oas&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">subject</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">covariance_matrices</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApplePyClassifier.independent_features_selection"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.independent_features_selection">[docs]</a>    <span class="k">def</span> <span class="nf">independent_features_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_sources</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channels_to_select</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_groups</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies independent channel or zone selection on the data, without the pipelines. Only the selected channels or zones will be</span>
<span class="sd">        kept on the final data.  \n </span>
<span class="sd">        Parameters  \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        use_sources : boolean; whether or not to use sources for feature selection \n</span>
<span class="sd">        cv : int; number of folds for cross validation \n</span>
<span class="sd">        channels_to_select : int; if any, the desired number of features  \n</span>
<span class="sd">        use_groups : boolean; whether or not to use groups when dividing the data \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_sources</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electrodes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_sources</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span>

        <span class="n">dataset_cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_covariance_matrices</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_data</span><span class="p">())</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>

        <span class="n">nb_subjects</span> <span class="o">=</span> <span class="n">dataset_cov</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nb_channels</span> <span class="o">=</span> <span class="n">dataset_cov</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">nb_subjects</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dataset_cov</span> <span class="o">=</span> <span class="n">dataset_cov</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">dataset_cov</span><span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="n">cv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_folder</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nb_channels</span> <span class="o">&lt;=</span> <span class="n">CONST_MAX_1by1_ELECTRODES</span><span class="p">:</span>
            <span class="n">tries</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_channels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">nb_channels</span> <span class="o">&lt;=</span> <span class="n">CONST_MAX_5by5_ELECTRODES</span><span class="p">:</span>
            <span class="n">tries</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_channels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">nb_channels</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nb_channels</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tries</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_channels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">nb_channels</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nb_channels</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">channels_to_select</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">es</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">ElectrodeSelection</span><span class="p">(),</span> <span class="n">param_grid</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;nelec&quot;</span><span class="p">:</span> <span class="n">tries</span><span class="p">},</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
                              <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">score_func_independent_feat_selection</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">use_groups</span><span class="p">:</span>
                <span class="n">es</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset_cov</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">es</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset_cov</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
            <span class="c1"># idx = es.best_index_</span>
            <span class="n">selected_estimator</span> <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="n">best_estimator_</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of selected features : &quot;</span><span class="p">,</span> <span class="n">selected_estimator</span><span class="o">.</span><span class="n">nelec</span><span class="p">)</span>
            <span class="n">selected_feats_idx</span> <span class="o">=</span> <span class="n">selected_estimator</span><span class="o">.</span><span class="n">subelec_</span>
            <span class="n">selected_feats</span> <span class="o">=</span> <span class="p">[</span><span class="n">feats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">selected_feats_idx</span><span class="p">]</span>
            <span class="n">additional_informations</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;independent features selection&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s2">&quot;pre_selected number of features&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s2">&quot;selected number of features&quot;</span><span class="p">,</span> <span class="n">selected_estimator</span><span class="o">.</span><span class="n">nelec</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">selected_feats</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You have chosen to select the best &quot;</span><span class="p">,</span> <span class="n">channels_to_select</span><span class="p">,</span> <span class="s2">&quot; channels.&quot;</span><span class="p">)</span>
            <span class="n">es</span> <span class="o">=</span> <span class="n">ElectrodeSelection</span><span class="p">(</span><span class="n">nelec</span><span class="o">=</span><span class="n">channels_to_select</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">dataset_cov</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">es</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset_cov</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
            <span class="n">selected_feats_idx</span> <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="n">subelec_</span>
            <span class="n">selected_feats</span> <span class="o">=</span> <span class="p">[</span><span class="n">feats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">selected_feats_idx</span><span class="p">]</span>
            <span class="n">additional_informations</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;independent ChanVertexSelection&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s2">&quot;pre_selected number of features&quot;</span><span class="p">,</span> <span class="n">channels_to_select</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">selected_feats</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">additional_informations</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected features are : &quot;</span><span class="p">,</span> <span class="n">selected_feats</span><span class="p">)</span>
        <span class="c1"># for person_idx in range(self.dataset.shape[0]):</span>
        <span class="c1">#     self.dataset[person_idx] = self.dataset[person_idx][:, selected_feats_idx, :]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span></div>

<div class="viewcode-block" id="ApplePyClassifier.tune_hyperparameters"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.tune_hyperparameters">[docs]</a>    <span class="k">def</span> <span class="nf">tune_hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">use_sources</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_groups</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tune the hyperparameters for the different pipelines and replace the pipelines by their improved versions. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        cv : cross validation for tuning \n</span>
<span class="sd">        use_sources : boolean; whether or not to use the sources dataset \n</span>
<span class="sd">        use_groups : boolean; whether or not to use groups for the cross validation \n</span>
<span class="sd">        factor : int; the stair by which to augment the number of filters or electrodes \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="s2">&quot;hyperparameters tuning&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;cross validation for tuning&quot;</span><span class="p">,</span> <span class="n">cv</span><span class="p">)])</span>

        <span class="n">max_filters</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electrodes</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_filters</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">additional_filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_filters</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">additional_filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_filters</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">factor</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">max_filters</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">additional_filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_filters</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_catalogue</span><span class="o">.</span><span class="n">XDAWN_filters</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">additional_filters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_catalogue</span><span class="o">.</span><span class="n">csp_filters</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">additional_filters</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">use_sources</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_sources</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_folder</span><span class="p">(</span><span class="n">cv</span><span class="p">)</span>

        <span class="n">nb_subjects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_subj</span>
        <span class="n">nb_channels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electrodes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nb_subjects</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nb_channels</span> <span class="o">&lt;=</span> <span class="n">CONST_MAX_1by1_ELECTRODES</span><span class="p">:</span>
                <span class="n">nb_elec</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_channels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="k">elif</span> <span class="n">nb_channels</span> <span class="o">&lt;=</span> <span class="n">CONST_MAX_5by5_ELECTRODES</span><span class="p">:</span>
                <span class="n">nb_elec</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_channels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">nb_channels</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">nb_elec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nb_channels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nb_elec</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_channels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">nb_channels</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">nb_elec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nb_channels</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nb_elec</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_channels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">nb_channels</span> <span class="o">%</span> <span class="n">factor</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nb_elec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nb_channels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_catalogue</span><span class="o">.</span><span class="n">nb_elec</span> <span class="o">=</span> <span class="n">nb_elec</span>

        <span class="n">pipelines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pipelines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">grid_searches</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">random_searches</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pipeline</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">grid_searches</span><span class="p">[</span><span class="n">pipeline</span><span class="p">]</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="p">[</span><span class="n">pipeline</span><span class="p">],</span>
                                                       <span class="n">param_grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">distribution</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_filters</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span> <span class="n">distribution</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
                                                <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="mi">1</span><span class="p">]))}</span>
                <span class="n">random_searches</span><span class="p">[</span><span class="n">pipeline</span><span class="p">]</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="p">[</span><span class="n">pipeline</span><span class="p">],</span>
                                                               <span class="n">param_distributions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                               <span class="n">n_iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">gs</span> <span class="ow">in</span> <span class="n">grid_searches</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_groups</span><span class="p">:</span>
                <span class="n">grid_searches</span><span class="p">[</span><span class="n">gs</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">grid_searches</span><span class="p">[</span><span class="n">gs</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
            <span class="n">selected_estimator</span> <span class="o">=</span> <span class="n">grid_searches</span><span class="p">[</span><span class="n">gs</span><span class="p">]</span><span class="o">.</span><span class="n">best_estimator_</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="p">[</span><span class="n">gs</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_estimator</span>

        <span class="k">for</span> <span class="n">gs</span> <span class="ow">in</span> <span class="n">random_searches</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_groups</span><span class="p">:</span>
                <span class="n">random_searches</span><span class="p">[</span><span class="n">gs</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">random_searches</span><span class="p">[</span><span class="n">gs</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
            <span class="n">selected_estimator</span> <span class="o">=</span> <span class="n">random_searches</span><span class="p">[</span><span class="n">gs</span><span class="p">]</span><span class="o">.</span><span class="n">best_estimator_</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="p">[</span><span class="n">gs</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_estimator</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pipelines&#39; hyperparameters have been tuned&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApplePyClassifier.fit"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits all the pipeline to a provided dataset. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        x_train : the training samples \n</span>
<span class="sd">        y_train : the correct answers to the training samples \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipelines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pipelines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">pipeline_name</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="p">:</span>
            <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors encountered with pipeline &quot;</span> <span class="o">+</span> <span class="n">pipeline_name</span> <span class="o">+</span> <span class="s2">&quot;. This pipeline will be removed.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_pipelines</span><span class="p">([</span><span class="n">pipeline_name</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ApplePyClassifier.fit_transform"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.fit_transform">[docs]</a>    <span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApplePyClassifier.predict"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_test</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predicts the values for a dataset. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        x_test : the test samples \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipelines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pipelines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">pipeline_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">round_predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pipeline_name</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="p">:</span>
            <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span>

            <span class="n">preds</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
            <span class="n">round_predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">preds</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">pipeline_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">round_predictions</span></div>

<div class="viewcode-block" id="ApplePyClassifier.predict_proba"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.predict_proba">[docs]</a>    <span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_test</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predicts with probabilities the values for a dataset. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        x_test : the test samples \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipelines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pipelines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">pipeline_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">round_predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pipeline_name</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="p">:</span>
            <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span>

            <span class="n">preds</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
            <span class="n">round_predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>
            <span class="n">preds_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">preds</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predictions_proba</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds_abs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="n">pipeline_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">round_predictions</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scores</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ApplePyClassifier.final_score"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.final_score">[docs]</a>    <span class="k">def</span> <span class="nf">final_score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Final scoring function. For each pipeline, a score, confusion matrix, precision, recall, and ROC curve is created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
        <span class="n">pipelines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pipelines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_answers</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_subj</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pipeline_name</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="p">:</span>
                <span class="n">predictions_pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span>
                <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">precision</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">recall</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">confusion_matrix</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">pred_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions_pipeline</span><span class="p">)):</span>
                    <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">expected</span><span class="p">[</span><span class="n">pred_idx</span><span class="p">]][</span><span class="n">predictions_pipeline</span><span class="p">[</span><span class="n">pred_idx</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">corrects</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span><span class="p">)])</span>
                <span class="n">score</span> <span class="o">=</span> <span class="n">corrects</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">precision</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">precision</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">recall</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">recall</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">precisions</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">recalls</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">confusion_matrices</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">confusion_matrix</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c1"># ROC curve</span>
                    <span class="n">preds_proba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions_proba</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span>
                    <span class="n">positive_proba</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">preds_proba</span><span class="p">)):</span>
                        <span class="n">positive_proba</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds_proba</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">positive_proba</span><span class="p">)</span>
                    <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">roc_infos</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">auc_scores</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roc_infos</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">pipeline</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roc_infos</span><span class="p">:</span>
                    <span class="n">auc_scores</span><span class="p">[</span><span class="n">pipeline</span><span class="p">]</span> <span class="o">=</span> <span class="n">auc_scores</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;pipelines : &#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;scores auc&quot;</span><span class="p">,</span> <span class="n">auc_scores</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;recalls&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recalls</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;precisions&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisions</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span></div>

<div class="viewcode-block" id="ApplePyClassifier.score"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.score">[docs]</a>    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the accuracy on the given test data and labels. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        x : test samples \n</span>
<span class="sd">        y : correct answers for x \n</span>
<span class="sd">        weights : Sample weights \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipelines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pipelines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>

        <span class="k">for</span> <span class="n">pipeline_name</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="p">:</span>
            <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">scores</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>

        <span class="k">return</span> <span class="n">scores</span></div>

<div class="viewcode-block" id="ApplePyClassifier.score_all_pipelines"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.score_all_pipelines">[docs]</a>    <span class="k">def</span> <span class="nf">score_all_pipelines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the accuracy on the given predictions and labels for all trained pipelines. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        x : test samples \n</span>
<span class="sd">        y : correct answers for x \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">()))]</span>
        <span class="k">for</span> <span class="n">pipeline</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pipeline</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">scores</span><span class="p">[</span><span class="n">pipeline</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">scores</span><span class="p">[</span><span class="n">pipeline</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">pipeline</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pipeline</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">scores</span></div>

<div class="viewcode-block" id="ApplePyClassifier.predict_test_dataset"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.predict_test_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">predict_test_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predicts the left out test dataset, computes the score and shows the results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span>

        <span class="n">dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_answers</span> <span class="o">=</span> <span class="n">labels</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">final_score</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApplePyClassifier.score_func_independent_feat_selection"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.score_func_independent_feat_selection">[docs]</a>    <span class="k">def</span> <span class="nf">score_func_independent_feat_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scoing function for the independent feature selection. The previously trained pipeline is used to predict the test dataset. \n</span>
<span class="sd">        At the end, the predicted data are compared to the correct answers, and the percentage of correctly classified data is considered the score. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        estimator : the estimator that predicts and scores \n</span>
<span class="sd">        x_test : the test dataset \n</span>
<span class="sd">        y_test : the correct answers to the dataset \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_test</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">pipeline</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">predictions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">y_test</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">score</span> <span class="o">/</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">score</span></div>

<div class="viewcode-block" id="ApplePyClassifier.score_func"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.score_func">[docs]</a>    <span class="k">def</span> <span class="nf">score_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scoing function for the independent feature selection. The previously trained pipeline is used to predict the test dataset.</span>
<span class="sd">        At the end, the predicted data are compared to the correct answers, and the percentage of correctly classified data is considered the score. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        estimator : the estimator that predicts and scores \n</span>
<span class="sd">        x_test : the test dataset \n</span>
<span class="sd">        y_test : the correct answers to the dataset \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">estimator_steps</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">named_steps</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">estimator_steps</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">estimator_steps</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">x_test</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">predictions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">y_test</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">score</span> <span class="o">/</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">score</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ApplePyClassifier.plot_ROC"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.plot_ROC">[docs]</a>    <span class="k">def</span> <span class="nf">plot_ROC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb_lines</span><span class="p">,</span> <span class="n">nb_columns</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the ROC curves for all the pipelines from the catalogue. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        nb_lines : the number of lines to be used for all the pipelines \n</span>
<span class="sd">        nb_columns : the number of columns to be used for all the pipelines \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipelines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pipelines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="c1"># pipeline_counter = 0</span>

        <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nb_lines</span><span class="p">,</span> <span class="n">nb_columns</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">pipeline_name</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="p">:</span>
            <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">auc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roc_infos</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span>
            <span class="c1"># plt.subplot(nb_lines, nb_columns, pipeline_counter + 1)</span>
            <span class="c1"># title = pipeline_name + &quot; : &quot; + str(self.scores[pipeline_name])</span>

            <span class="k">if</span> <span class="n">nb_lines</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;AUC = </span><span class="si">%0.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">auc</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">)</span>
                <span class="c1"># pipeline_counter += 1</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="n">nb_columns</span><span class="p">:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;AUC = </span><span class="si">%0.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">auc</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="ApplePyClassifier.plot_confusion"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.plot_confusion">[docs]</a>    <span class="k">def</span> <span class="nf">plot_confusion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb_lines</span><span class="p">,</span> <span class="n">nb_columns</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the confusion matrices for all the pipelines from the catalogue. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        nb_lines : the number of lines to be used for all the pipelines \n</span>
<span class="sd">        nb_columns : the number of columns to be used for all the pipelines \n</span>
<span class="sd">        names : list; list containing the names of the labels for the categories. \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipelines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pipelines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">pipeline_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">pipeline_name</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="p">:</span>
            <span class="n">confusion_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confusion_matrices</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">]</span>
            <span class="n">plotted_confusion_matrix</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">))]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">)):</span>
                    <span class="n">plotted_confusion_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nb_lines</span><span class="p">,</span> <span class="n">nb_columns</span><span class="p">,</span> <span class="n">pipeline_counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">)</span>
            <span class="n">sn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">plotted_confusion_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;YlGnBu&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">names</span><span class="p">,</span>
                       <span class="n">yticklabels</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
            <span class="n">pipeline_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="ApplePyClassifier.show_results"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.show_results">[docs]</a>    <span class="k">def</span> <span class="nf">show_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb_columns</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows the ROC curves and the confusion matrices for all the pipelines. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        nb_columns : the number of columns to be used for all the pipelines \n</span>
<span class="sd">        names : list; list containing the names of the labels for the categories. \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipelines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pipelines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">nb_lines</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pipelines</span><span class="p">)</span> <span class="o">/</span> <span class="n">nb_columns</span><span class="p">)</span>
        <span class="c1"># Confusion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_confusion</span><span class="p">(</span><span class="n">nb_lines</span><span class="p">,</span> <span class="n">nb_columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_names</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># ROC</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_ROC</span><span class="p">(</span><span class="n">nb_lines</span><span class="p">,</span> <span class="n">nb_columns</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApplePyClassifier.plot_ROC_"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.plot_ROC_">[docs]</a>    <span class="k">def</span> <span class="nf">plot_ROC_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb_columns</span><span class="p">):</span>
        <span class="n">pipelines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pipelines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">nb_lines</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pipelines</span><span class="p">)</span> <span class="o">/</span> <span class="n">nb_columns</span><span class="p">)</span>
        <span class="c1"># ROC</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_ROC</span><span class="p">(</span><span class="n">nb_lines</span><span class="p">,</span> <span class="n">nb_columns</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApplePyClassifier.plot_confusion_"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.plot_confusion_">[docs]</a>    <span class="k">def</span> <span class="nf">plot_confusion_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb_columns</span><span class="p">):</span>
        <span class="n">pipelines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pipelines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">nb_lines</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pipelines</span><span class="p">)</span> <span class="o">/</span> <span class="n">nb_columns</span><span class="p">)</span>
        <span class="c1"># Confusion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_confusion</span><span class="p">(</span><span class="n">nb_lines</span><span class="p">,</span> <span class="n">nb_columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_names</span><span class="p">)</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classification</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ApplePyClassifier.classify"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.classify">[docs]</a>    <span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">dataset_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_dataset_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cv_value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">independent_features_selection</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">channels_to_select</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">use_groups</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tune_hypers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">classify_test</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Global classification method of the library. (inter-subjects)\n</span>
<span class="sd">        Reads the dataset, can apply independent features selection, can tune hyperparameters, fits, predicts, scores, and shows results.\n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset : string; the path to the dataset \n</span>
<span class="sd">        test_dataset_size : int; the fraction of the dataset to be considered for testing \n</span>
<span class="sd">        pre_epoched : boolean; whether the dataset is already epoched or not\n</span>
<span class="sd">        tmin, tmax : time limits for the epochs \n</span>
<span class="sd">        bads : list of electrodes to be rejected \n</span>
<span class="sd">        picks : list of electrodes to be worked on \n</span>
<span class="sd">        filtering : tuple containing the higher and lower frequencies to filter the data \n</span>
<span class="sd">        tmin, tmax : tmin, tmax for delimiting the epochs in time \n</span>
<span class="sd">        ICA : Boolean, whether to apply Independent Component Analysis or not\n</span>
<span class="sd">        resample : boolean, whether to resample the data at 512 Hz or not \n</span>
<span class="sd">        baseline : the baseline to be applied to the data  \n</span>
<span class="sd">        cv_value : int; the number of folds for cross validation. If None, the number of subjects will be used (Leave one out) \n</span>
<span class="sd">        independent_features_selection : boolean; whether to apply independent features selection or not \n</span>
<span class="sd">        channels_to_select : int or None; the number of channels to be selected or None if automatic number selection \n</span>
<span class="sd">        use_groups : boolean; whether to use groups for cross validation or not \n</span>
<span class="sd">        tune_hypers : boolean; whether to tune hyperparameters or not \n</span>
<span class="sd">        names : list; names of the categories \n</span>
<span class="sd">        classify_test : boolean; whether there should be a separate test dataset or not \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electrodes</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;ch_names&quot;</span><span class="p">]</span>

        <span class="n">labels_dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">labels_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
            <span class="n">event_label</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">event_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels_dic</span><span class="p">:</span>
                <span class="n">labels_dic</span><span class="p">[</span><span class="n">event_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels_idx</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">event_id</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">dataset</span><span class="o">.</span><span class="n">event_id</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">event_label</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">event_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">labels_idx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_dic</span><span class="p">[</span><span class="n">event_label</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_paradigms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">event_id</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">classify_test</span> <span class="ow">and</span> <span class="n">test_dataset_size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">limit_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">test_dataset_size</span>
                <span class="n">limit_dataset_0</span> <span class="o">=</span> <span class="n">limit_dataset</span> <span class="o">//</span> <span class="mi">2</span>
                <span class="n">limit_dataset_1</span> <span class="o">=</span> <span class="n">limit_dataset</span> <span class="o">-</span> <span class="n">limit_dataset_0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[:</span><span class="n">limit_dataset_0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="o">-</span><span class="n">limit_dataset_1</span><span class="p">:]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">limit_dataset_0</span><span class="p">:</span><span class="o">-</span><span class="n">limit_dataset_1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[:</span><span class="n">limit_dataset_0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="n">limit_dataset_1</span><span class="p">:]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">limit_dataset_0</span><span class="p">:</span><span class="o">-</span><span class="n">limit_dataset_1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">use_groups</span><span class="p">:</span>
            <span class="n">cv</span> <span class="o">=</span> <span class="n">GroupKFold</span><span class="p">(</span><span class="n">cv_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cv</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">cv_value</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">independent_features_selection</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">independent_features_selection</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">channels_to_select</span><span class="o">=</span><span class="n">channels_to_select</span><span class="p">,</span> <span class="n">use_groups</span><span class="o">=</span><span class="n">use_groups</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Independent features selection error&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tune_hypers</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tune_hyperparameters</span><span class="p">(</span><span class="n">cv_value</span><span class="p">,</span> <span class="n">use_sources</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_groups</span><span class="o">=</span><span class="n">use_groups</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hyperparameters tuning error&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_groups</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>

        <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">):</span>

            <span class="n">x_train</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>
            <span class="n">y_train</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>

            <span class="n">x_test</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
            <span class="n">y_test</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
            <span class="n">predictions_proba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pipeline</span> <span class="ow">in</span> <span class="n">scores</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scores_fold</span><span class="p">[</span><span class="n">pipeline</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">pipeline</span><span class="p">])</span>
            <span class="n">predictions_proba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predictions_proba</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expected_answers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">final_score</span><span class="p">()</span>
        <span class="n">pipelines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pipelines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Predictions&#39;</span><span class="p">,</span> <span class="s2">&quot;see &#39;predictions.npy&#39; in dataset folder&quot;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="s2">&quot;predictions.npy&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_program_log</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">classify_test</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">test_dataset_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Test dataset size is 0. Test dataset estimation can not be applied.&quot;</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predict_test_dataset</span><span class="p">()</span></div>

<div class="viewcode-block" id="ApplePyClassifier.classify_intraSubject"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.classify_intraSubject">[docs]</a>    <span class="k">def</span> <span class="nf">classify_intraSubject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">divided_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nb_subj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_dataset_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pre_epoched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">tmin</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filtering</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">ICA</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">resample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event_ids</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">cv_value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">independent_features_selection</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channels_to_select</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                              <span class="n">tune_hypers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">classify_test</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_all_pipelines</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Global classification method of the library. (intra-subject) \n</span>
<span class="sd">        Reads the dataset, can apply independent features selection, can tune hyperparameters, fits, predicts, scores, and shows results. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        dataset : string; the path to the dataset \n</span>
<span class="sd">        nb_subj : int; number of subjects to consider \n</span>
<span class="sd">        test_dataset_size : int; the fraction of the dataset to be considered for testing \n</span>
<span class="sd">        pre_epoched : boolean; whether or not the dataset is already epoched \n</span>
<span class="sd">        tmin, tmax : time limits for the epochs \n</span>
<span class="sd">        bads : list of electrodes to be rejected \n</span>
<span class="sd">        picks : list of electrodes to be worked on \n</span>
<span class="sd">        filtering : tuple containing the higher and lower frequencies to filter the data \n</span>
<span class="sd">        tmin, tmax : tmin, tmax for delimiting the epochs in time \n</span>
<span class="sd">        ICA : Boolean, whether or not to apply Independent Component Analysis \n</span>
<span class="sd">        resample : boolean, whether or not to resample the data at 512 Hz \n</span>
<span class="sd">        baseline : the baseline to be applied to the data  \n</span>
<span class="sd">        cv_value : int; the number of folds for cross validation. If None, the number of subjects will be used (Leave one out) \n</span>
<span class="sd">        independent_features_selection : boolean; whether or not to apply independent features selection \n</span>
<span class="sd">        channels_to_select : int or None; the number of channels to be selected or None if automatic number selection \n</span>
<span class="sd">        tune_hypers : boolean; whether or not to tune hyperparameters \n</span>
<span class="sd">        names : list; names of the categories \n</span>
<span class="sd">        classify_test : boolean; whether or not there should be a separate test dataset \n</span>
<span class="sd">        use_all_pipelines : boolean; whether or not all the pipelines should be used for classification or only a subset \n</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_all_pipelines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_pipelines</span><span class="p">([</span><span class="s1">&#39;XdawnCov&#39;</span><span class="p">,</span> <span class="s1">&#39;Xdawn&#39;</span><span class="p">,</span> <span class="s1">&#39;CSP&#39;</span><span class="p">,</span> <span class="s1">&#39;Cosp&#39;</span><span class="p">,</span> <span class="s1">&#39;HankelCov&#39;</span><span class="p">,</span> <span class="s1">&#39;CSSP&#39;</span><span class="p">,</span> <span class="s1">&#39;PSD&#39;</span><span class="p">,</span> <span class="s1">&#39;FgMDM&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">nb_subj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nb_subj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_subjects</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">test_dataset_size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">limit_dataset</span> <span class="o">=</span> <span class="n">nb_subj</span> <span class="o">//</span> <span class="n">test_dataset_size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_all_files</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">nb_subj</span><span class="p">,</span> <span class="n">divided_dataset</span><span class="o">=</span><span class="n">divided_dataset</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">,</span>
                            <span class="n">pre_epoched</span><span class="o">=</span><span class="n">pre_epoched</span><span class="p">,</span> <span class="n">bads</span><span class="o">=</span><span class="n">bads</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="n">picks</span><span class="p">,</span> <span class="n">filtering</span><span class="o">=</span><span class="n">filtering</span><span class="p">,</span> <span class="n">ICA</span><span class="o">=</span><span class="n">ICA</span><span class="p">,</span>
                            <span class="n">resample</span><span class="o">=</span><span class="n">resample</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">,</span> <span class="n">event_ids</span><span class="o">=</span><span class="n">event_ids</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">classify_test</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">test_dataset_size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">test_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="o">-</span><span class="n">limit_dataset</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[:</span><span class="o">-</span><span class="n">limit_dataset</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="n">limit_dataset</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[:</span><span class="o">-</span><span class="n">limit_dataset</span><span class="p">]</span>

                <span class="n">idx</span> <span class="o">=</span> <span class="n">nb_subj</span> <span class="o">-</span> <span class="n">limit_dataset</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">nb_subj</span><span class="p">):</span>
                    <span class="n">lst_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">test_groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_groups</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">lst_idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span> <span class="n">lst_idx</span><span class="p">)</span>

        <span class="n">loo</span> <span class="o">=</span> <span class="n">LeaveOneOut</span><span class="p">()</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">cv_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">independent_features_selection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">independent_features_selection</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv_value</span><span class="p">,</span> <span class="n">channels_to_select</span><span class="o">=</span><span class="n">channels_to_select</span><span class="p">,</span>
                                                <span class="n">use_groups</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tune_hypers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tune_hyperparameters</span><span class="p">(</span><span class="n">cv_value</span><span class="p">,</span> <span class="n">use_sources</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_groups</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">loo</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">):</span>
            <span class="n">x_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">test_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">test_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="k">for</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">y_train</span><span class="p">[</span><span class="n">train</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">x_train</span><span class="p">[</span><span class="n">test</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expected_answers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="n">test</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">final_score</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="p">)</span>
        <span class="n">pipelines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalogue</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pipelines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pipelines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Predictions&#39;</span><span class="p">,</span> <span class="s2">&quot;see &#39;predictions.npy&#39; in dataset folder&quot;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="s2">&quot;predictions.npy&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_program_log</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">classify_test</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">test_dataset_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Test dataset size is 0. Test dataset estimation can not be applied.&quot;</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">predict_test_dataset</span><span class="p">()</span></div>

<div class="viewcode-block" id="ApplePyClassifier.classify_with_CNN"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.classify_with_CNN">[docs]</a>    <span class="k">def</span> <span class="nf">classify_with_CNN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">nb_subj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">divided_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pre_epoched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                          <span class="n">bads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filtering</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">ICA</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">event_ids</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Global classification method of the library. (inter-subjects) \n</span>
<span class="sd">        Reads the dataset, can apply independent features selection, can tune hyperparameters, fits, predicts, scores, and shows results. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        dataset : string; the path to the dataset \n</span>
<span class="sd">        nb_subj : int; number of subjects to consider \n</span>
<span class="sd">        test_dataset_size : int; the fraction of the dataset to be considered for testing \n</span>
<span class="sd">        pre_epoched : boolean; whether or not the dataset is already epoched \n</span>
<span class="sd">        tmin, tmax : time limits for the epochs \n</span>
<span class="sd">        bads : list of electrodes to be rejected \n</span>
<span class="sd">        picks : list of electrodes to be worked on \n</span>
<span class="sd">        filtering : tuple containing the higher and lower frequencies to filter the data \n</span>
<span class="sd">        tmin, tmax : tmin, tmax for delimiting the epochs in time \n</span>
<span class="sd">        ICA : Boolean, whether or not to apply Independent Component Analysis \n</span>
<span class="sd">        resample : boolean, whether or not to resample the data at 512 Hz \n</span>
<span class="sd">        baseline : the baseline to be applied to the data  \n</span>
<span class="sd">        cv_value : int; the number of folds for cross validation. If None, the number of subjects will be used (Leave one out) \n</span>
<span class="sd">        independent_features_selection : boolean; whether or not to apply independent features selection \n</span>
<span class="sd">        channels_to_select : int or None; the number of channels to be selected or None if automatic number selection \n</span>
<span class="sd">        use_groups : boolean; whether or not to use groups for cross validation \n</span>
<span class="sd">        tune_hypers : boolean; whether or not to tune hyperparameters \n</span>
<span class="sd">        names : list; names of the categories \n</span>
<span class="sd">        classify_test : boolean; whether or not there should be a separate test dataset \n</span>
<span class="sd">        use_all_pipelines : boolean; whether or not all the pipelines should be used for classification or only a subset \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># dataset_path = dataset</span>

        <span class="k">if</span> <span class="n">nb_subj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nb_subj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_subjects</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
            <span class="n">nb_subj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_subj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nb_subj</span> <span class="o">=</span> <span class="n">nb_subj</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_all_files</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">nb_subj</span><span class="p">,</span> <span class="n">divided_dataset</span><span class="o">=</span><span class="n">divided_dataset</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">,</span>
                            <span class="n">pre_epoched</span><span class="o">=</span><span class="n">pre_epoched</span><span class="p">,</span> <span class="n">bads</span><span class="o">=</span><span class="n">bads</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="n">picks</span><span class="p">,</span> <span class="n">filtering</span><span class="o">=</span><span class="n">filtering</span><span class="p">,</span> <span class="n">ICA</span><span class="o">=</span><span class="n">ICA</span><span class="p">,</span>
                            <span class="n">resample</span><span class="o">=</span><span class="n">resample</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">,</span> <span class="n">event_ids</span><span class="o">=</span><span class="n">event_ids</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if self.nb_subj == 1:</span>
<span class="sd">            self.dataset = self.dataset[0]</span>
<span class="sd">            self.labels = self.labels[0]</span>
<span class="sd">            use_groups=False</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">limit_dataset</span> <span class="o">=</span> <span class="n">nb_subj</span> <span class="o">//</span> <span class="n">test_size</span>
        <span class="n">x_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">limit_dataset</span><span class="p">])</span>
        <span class="n">x_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">limit_dataset</span><span class="p">:])</span>

        <span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">limit_dataset</span><span class="p">])</span>
        <span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">limit_dataset</span><span class="p">:])</span>

        <span class="n">x_train</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">x_test</span> <span class="o">=</span> <span class="n">x_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">y_test_biss</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_train_biss</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">y_test</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y_test_biss</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">y_test</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">y_test_biss</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error here test&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">y_train</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y_train_biss</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">y_train</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">y_train_biss</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error here train&quot;</span><span class="p">)</span>

        <span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_train_biss</span><span class="p">)</span>
        <span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_test_biss</span><span class="p">)</span>

        <span class="n">cnn</span> <span class="o">=</span> <span class="n">CNN</span><span class="p">()</span>
        <span class="n">cnn</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
        <span class="n">cnn</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">cnn</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
        <span class="n">cnn</span><span class="o">.</span><span class="n">show_results</span><span class="p">()</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Others</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ApplePyClassifier.count_subjects"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.count_subjects">[docs]</a>    <span class="k">def</span> <span class="nf">count_subjects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Count the number of subjects in the dataset. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        directory : the path to the dataset \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subfolders</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subfolders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;epoched&quot;</span><span class="p">:</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">subfolders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">subfolders</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">list_of_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">raw_eeg_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;.set&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;directory&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;.txt&quot;</span> <span class="ow">in</span> <span class="n">raw_eeg_file</span><span class="p">):</span>
                <span class="n">list_of_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_eeg_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_subj</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApplePyClassifier.save_program_log"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.save_program_log">[docs]</a>    <span class="k">def</span> <span class="nf">save_program_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the program log in a file. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        path : string; path to the place where the file will be saved. \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;program_log.txt&quot;</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_log</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApplePyClassifier.create_folder"><a class="viewcode-back" href="../../../../src.classification.applePy.html#src.classification.applePy.classifier.ApplePyClassifier.create_folder">[docs]</a>    <span class="k">def</span> <span class="nf">create_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the k-folds folder for the data. \n</span>
<span class="sd">        Parameters \n</span>
<span class="sd">        ---------- \n</span>
<span class="sd">        k : int \n</span>
<span class="sd">            number of folds \n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">folder</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">MNE Vision 0.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Lemahieu Antoine.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>